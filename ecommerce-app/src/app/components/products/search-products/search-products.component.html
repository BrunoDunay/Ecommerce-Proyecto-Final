<div class="relative">
  <nav class="bg-white shadow-lg fixed top-0 left-0 right-0 z-60">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-4">

      <div class="flex items-center">
        <a routerLink="/" class="flex items-center gap-2">
          <div
            class="w-9 h-9 rounded-full bg-slate-900 flex items-center justify-center text-white font-bold text-sm"
          >
            T
          </div>
          <span class="font-bold text-slate-800 hidden sm:inline">
            TechStore
          </span>
        </a>
      </div>

      <div class="hidden md:flex flex-1 justify-center gap-6 text-sm sm:text-base">
        <a
          routerLink="/"
          routerLinkActive="text-orange-600 font-semibold"
          class="text-slate-700 hover:text-orange-500 transition-colors"
        >
          Inicio
        </a>

        <a
          routerLink="/products"
          routerLinkActive="text-orange-600 font-semibold"
          class="text-slate-700 hover:text-orange-500 transition-colors"
        >
          Productos
        </a>

        <a
          *ngIf="user$ | async as user"
          routerLink="/user"
          routerLinkActive="text-orange-600 font-semibold"
          class="text-slate-700 hover:text-orange-500 transition-colors"
        >
          Mi perfil
        </a>
      </div>

      <div class="hidden md:block flex-[1.4] min-w-[220px]">
        <form [formGroup]="searchProductForm" class="flex items-center">
          <div class="flex-1 relative">
            <input
              type="text"
              formControlName="q"
              placeholder="Buscar productos..."
              class="w-full pl-3 pr-9 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 text-sm"
            />

            <button
              type="button"
              class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.8"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m21 21-4.35-4.35M11 18a7 7 0 1 0 0-14 7 7 0 0 0 0 14Z"
                />
              </svg>
            </button>
          </div>
        </form>
      </div>

    </div>
  </nav>

  @if (searchProductForm.get('q')?.value &&
       searchProductForm.get('q')?.value!.length > 0) {

    <div
      class="absolute top-full left-0 right-0 z-40 bg-white shadow-xl border-t max-w-6xl mx-auto"
    >
      <div class="p-4">
        @if (products$ | async; as products ) {
          <div
            class="grid grid-cols-1 md:grid-cols-2 gap-2 max-h-60 overflow-y-auto"
          >
            @for (product of products; track $index) {
              <div
                class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded cursor-pointer"
                [routerLink]="['/product-view', product._id]"
              >
                <div class="w-12 h-12 bg-gray-200 rounded flex-shrink-0"></div>
                <div class="flex-1 min-w-0">
                  <h4 class="text-sm text-gray-700 truncate">{{ product.name }}</h4>
                  <p class="text-xs text-gray-500">
                    {{ product.price | currency:'MXN':'symbol-narrow' }}
                  </p>
                </div>
              </div>
            } @empty {
              <div class="text-center py-4 text-gray-500">
                No se encontraron productos
              </div>
            }
          </div>
        }
      </div>
    </div>

  }
</div>
